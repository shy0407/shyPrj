<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.pocket.persistence.mapper.PocketMapper">

<select resultType="PocketDTO" id="expense"> 
	SELECT POCKET_NO, EXPENSE_DATE, EXPENSE_DETAIL, EXPENSE_CASH, EXPENSE_CARD, EXPENSE_CATEGORY
	FROM aws.POCKET_INFO
	
</select>

<select resultType="PocketDTO" id="expenseCal"> 
	SELECT EXPENSE_DATE, EXPENSE_CATEGORY 
	FROM aws.POCKET_INFO
	
</select>



<update id ="edit">
	UPDATE aws.POCKET_INFO
	SET EXPENSE_DATE = #{expense_date}, EXPENSE_DETAIL =#{expense_detail}, 
		EXPENSE_CASH =#{expense_cash}, EXPENSE_CARD=#{expense_card}, EXPENSE_CATEGORY=#{expense_category}
	WHERE POCKET_NO=#{pocket_no}
</update>

<insert id="insertPocket" parameterType="PocketDTO" >
    INSERT INTO aws.POCKET_INFO(POCKET_NO, USER_NO,EXPENSE_DATE, EXPENSE_DETAIL,EXPENSE_CASH, EXPENSE_CARD, EXPENSE_CATEGORY) 
    VALUES((SELECT IFNULL(MAX(PI.POCKET_NO),10000000)+1 FROM aws.POCKET_INFO PI), '10000001',#{expense_date}, #{expense_detail},#{expense_cash},#{expense_card},#{expense_category})
</insert>

<delete id="deletePocket" parameterType="String">
	DELETE FROM aws.POCKET_INFO WHERE POCKET_NO=#{pocket_no}
</delete>

<insert id="insertExpense" parameterType="PocketDTO" >
    INSERT INTO aws.POCKET_INFO(POCKET_NO, USER_NO,EXPENSE_DATE, EXPENSE_DETAIL, EXPENSE_CATEGORY) 
    VALUES((SELECT IFNULL(MAX(PI.POCKET_NO),10000000)+1 FROM aws.POCKET_INFO PI), '10000001',#{expense_date}, #{expense_detail},#{expense_category})
</insert>


<!--첨부파일 등록 -->
<insert id="addAttach">
insert into aws.POCKET_IMG(FULL_NAME, POCKET_NO, USER_NO,REGDATE) values (#{fullName},(SELECT IFNULL(MAX(PI.POCKET_NO),10000000) FROM aws.POCKET_INFO PI),'10000002',NOW())

</insert>


<!-- 첨부파일 가져오기 -->
<select id="pocketImgAll" resultType="String" parameterType="String">
select FULL_NAME from aws.POCKET_IMG
where USER_NO=#{user_no}
order by REGDATE
</select>
</mapper>